---
import BaseLayout from './BaseLayout.astro';
import Section from '../components/ui/Section.astro';
import Card from '../components/ui/Card.astro';
import Icon from '../components/ui/Icon.astro';
import FlexRow from '../components/ui/FlexRow.astro';
import CTA from '../components/sections/CTASection.astro';
import NumberedCard from '../components/ui/NumberedCard.astro';

const { frontmatter } = Astro.props;

// SEO данные
const pageTitle =
  frontmatter.pageTitle || `Методика преподавания финского языка | Репетитор Григорий Конопелько`;
const pageDescription =
  frontmatter.metaDescription ||
  'Авторская методика обучения финскому языку с 15-летним опытом. Индивидуальный подход, современные материалы, подготовка к YKI.';
const canonicalUrl = frontmatter.canonicalUrl || 'https://grigori.konopelko.com/metodika/';

// Структурированные данные
const structuredData = {
  '@context': 'https://schema.org',
  '@type': 'Article',
  headline: frontmatter.title || 'Методика преподавания финского языка',
  description: pageDescription,
  author: {
    '@type': 'Person',
    name: 'Григорий Конопелько',
    jobTitle: 'Репетитор финского языка',
    experienceYears: '15',
    alumniOf: {
      '@type': 'CollegeOrUniversity',
      name: 'СПбГУ',
    },
  },
  datePublished: '2024-01-01',
  dateModified: new Date().toISOString().split('T')[0],
  mainEntityOfPage: {
    '@type': 'WebPage',
    '@id': canonicalUrl,
  },
  publisher: {
    '@type': 'Person',
    name: 'Григорий Конопелько',
  },
};

// FAQ данные
const faqData = frontmatter.faq || [
  {
    question: 'Сколько времени нужно чтобы выучить финский?',
    answer: 'Для базового общения (уровень А2) нужно 3-6 месяцев регулярных занятий.',
  },
];

// Типы для TypeScript
type PrincipleItem = {
  icon: keyof typeof import('../data/icons').ICONS;
  title: string;
  description: string;
};
type StageItem = {
  stage: string;
  description: string;
};
---

<BaseLayout
  title={pageTitle}
  description={pageDescription}
  canonicalUrl={canonicalUrl}
  structuredData={structuredData}
  faqData={faqData}
>
  <!-- Основной контент -->
  <Section variant="text">
    <h1>{frontmatter.title}</h1>
    {frontmatter.description && <p>{frontmatter.description}</p>}
    <slot />
  </Section>

  <!-- Ключевые принципы -->
  {
    frontmatter.keyPrinciples && (
      <Section>
        <h2>Ключевые принципы методики</h2>
        <FlexRow>
          {(frontmatter.keyPrinciples as PrincipleItem[]).map(
            (principle: PrincipleItem, index: number) => (
              <Card delay={index * 100}>
                <Icon name={principle.icon} size="lg" />
                <h3>{principle.title}</h3>
                <p>{principle.description}</p>
              </Card>
            )
          )}
        </FlexRow>
      </Section>
    )
  }

  <!-- Этапы обучения -->
  {
    frontmatter.learningStages && (
      <Section background="light">
        <h2>Этапы обучения</h2>
        <FlexRow>
          {(frontmatter.learningStages as StageItem[]).map((stage: StageItem, index: number) => (
            <NumberedCard
              number={index + 1}
              title={stage.stage}
              description={stage.description}
              delay={index * 100}
            />
          ))}
        </FlexRow>
      </Section>
    )
  }

  <!-- Призыв к действию -->
  <Section>
    <CTA
      title="Готовы учиться по эффективной методике?"
      subtitle="Запишитесь на первый урок и получите индивидуальную программу обучения"
      buttonText="Записаться на урок"
      buttonHref="/contact/"
    />
  </Section>
</BaseLayout>
